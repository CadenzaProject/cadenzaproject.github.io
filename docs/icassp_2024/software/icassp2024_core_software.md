---
id: core_software
title: Core Software
sidebar_label: Core Software
sidebar_position: 7.2
---

import useBaseUrl from '@docusaurus/useBaseUrl';


## HAAQI Speech Intelligibility model

This is a python implementation of the Hearing Aid Audio Quality Index (HAAQI) model which is used for objective estimation.
This will be used in the stage 1 evaluation of entrants (see [Rules](/docs/cadenza1/Take%20part/cc1_rules#stage-1-objective-evaluation)).

Note that HAAQI is not a binaural metric, instead, each channel must be processed separately. We average the left and right 
scores to produce a final overall score.

:::caution[Instructions and recommendations on the use of HAAQI]

You can call the HAAQI metric using the `clarity.evaluator.haaqi.compute_haaqi` function as:

```python
compute_haaqi(
    processed_signal,
    reference_signal,
    processed_sample_rate,
    reference_sample_rate,
    audiogram,
    equalisation,
    level1
)
 ```

1. The `processed_signal` corresponds to the output signal from `enhancement` block in the baseline.
2. The `reference_signal` corresponds to the amplified reference signal. This is generated by the `evaluation` block in the baseline.
3. It is recommended to resample the `processed_signal` and `reference_signal` signals to 24,000 Hz before calling the metric.
4. Set the parameters `processed_sample_rate` and `reference_sample_rate` equal to `24000`.
5. The audiogram corresponds to the left or right `audiogram object`.
6. Set `equalisation` to 2, which indicates to HAAQI that the `reference_signal` has `NAL-R` applied to it. 
7. Set the `level1` parameter to the level of the reference signal before applying the hearing aid amplification (NAL-R).
Recommended to set it as `65 - 20 * log10(RMS(reference signal before NAL-R))`

::::::danger[Note]
Please note that the `level1` parameter uses the reference signal without NAL-R amplification. 
And, the `reference_signal` expects the amplified version of the same signal used in `level1`.
::::::


## 4. References
<a name="refs"></a>

[1] Byrne, Denis, and Harvey Dillon. "The National Acoustic Laboratories'(NAL) new procedure for selecting the gain and frequency response of a hearing aid." Ear and hearing 7.4 (1986): 257-265.
